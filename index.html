<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>欢迎学弟学妹们！</title>
	<link rel="icon" type="image/x-icon" href="favicon.png">
	<script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.js"></script>
	<link rel="stylesheet" type="text/css" href="../random-name/css/index.css">
	<link href="https://fonts.googleapis.com/css2?family=KaiTi&display=swap" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="../random-name/css/style.css">
</head>

<body>
	<div class="container">
		<div class="index_containt">
			<div id="show_info">
				<div id="student_name">
					<h1 id="student_name_value">--/--</h1>
				</div>
				<div id="btn_container">
					<button id="start">开始</button>
				</div>
				<h4 id="student_number">还有 <span id='student_number_value'>0</span> 位同学未自我介绍</h4>
			</div>
		</div>
		<div class="drawn_students">
			<h3>加入材化高大家庭的学弟学妹们！</h3>
			<ul id="drawn_list">
				<!-- 已抽到的同学名单会显示在这里 -->
			</ul>
		</div>
	</div>
	<div id="fireworks">
		<canvas id="fireworks_canvas"></canvas>
		<div id="welcome_text">欢迎你！灿若星辰的浙大人！</div>
	</div>
</body>

</html>
<script>
	var studentData = [
		{ 姓名: "小红" },
		{ 姓名: "小明" },
		{ 姓名: "张伟" },
		{ 姓名: "王芳" },
		{ 姓名: "李娜" },
		{ 姓名: "刘强" },
		{ 姓名: "陈杰" },
		{ 姓名: "杨洋" },
		{ 姓名: "黄磊" },
		{ 姓名: "吴敏" },
		{ 姓名: "赵磊" },
		{ 姓名: "周涛" },
		{ 姓名: "徐丽" },
		{ 姓名: "孙颖" },
		{ 姓名: "马俊" },
		{ 姓名: "朱琳" },
		{ 姓名: "胡波" },
		{ 姓名: "郭鹏" },
		{ 姓名: "高峰" },
		{ 姓名: "林静" },
		{ 姓名: "罗浩" },
		{ 姓名: "冯洁" },
		{ 姓名: "唐亮" },
		{ 姓名: "董敏" },
		{ 姓名: "程飞" },
		{ 姓名: "蔡军" },
		{ 姓名: "谢玲" },
		{ 姓名: "潘雷" },
		{ 姓名: "魏伟" },
		{ 姓名: "任红" }
	];

	document.getElementById("student_number_value").innerText = studentData.length;

	document.getElementById('start').addEventListener('click', function () {
		if (studentData.length > 0) {
			var index = getRandom(0, studentData.length);
			var name = studentData[index].姓名;
			document.getElementById("student_name_value").innerHTML = name;

			// 将抽到的同学添加到已抽到名单中
			var li = document.createElement("li");
			li.textContent = name;
			document.getElementById("drawn_list").appendChild(li);

			studentData.splice(index, 1);
			document.getElementById("student_number_value").innerText = studentData.length;
			if (studentData.length == 0) {
				document.getElementById('start').disabled = true;
			}

			// 显示烟花效果和欢迎文字
			showFireworks();
		}
	});

	// 随机数
	function getRandom(min, max) {
		return Math.floor(Math.random() * (max - min)) + min;
	}

	// 显示烟花效果和欢迎文字
	function showFireworks() {
		var fireworksContainer = document.getElementById('fireworks');
		var canvas = document.getElementById('fireworks_canvas');
		canvas.width = window.innerWidth;
		canvas.height = window.innerHeight;

		fireworksContainer.style.display = 'flex';

		// 初始化烟花效果
		var ctx = canvas.getContext('2d');
		var fireworks = [];
		var particles = [];
		var colors = ['#ff0000', '#ff7f00', '#ffff00', '#00ff00', '#0000ff', '#4b0082', '#8f00ff', '#ff1493', '#00ffff', '#ffd700'];

		function createFirework(x, y, xEnd, yEnd) {
			var firework = {
				x: x,
				y: y,
				xEnd: xEnd,
				yEnd: yEnd,
				size: 2,
				speed: 4,
				angle: Math.atan2(yEnd - y, xEnd - x),
				particles: [],
				color: colors[Math.floor(Math.random() * colors.length)]
			};
			fireworks.push(firework);
		}

		function createParticles(x, y, color) {
			for (var i = 0; i < 400; i++) {
				var particle = {
					x: x,
					y: y,
					size: 2,
					speed: Math.random() * 3 + 1,
					angle: Math.random() * Math.PI * 2,
					alpha: 1,
					decay: Math.random() * 0.02 + 0.01,
					color: color
				};
				particles.push(particle);
			}
		}

		function updateFireworks() {
			for (var i = fireworks.length - 1; i >= 0; i--) {
				var firework = fireworks[i];
				firework.x += Math.cos(firework.angle) * firework.speed;
				firework.y += Math.sin(firework.angle) * firework.speed;

				if (Math.abs(firework.x - firework.xEnd) < firework.speed && Math.abs(firework.y - firework.yEnd) < firework.speed) {
					createParticles(firework.xEnd, firework.yEnd, firework.color);
					fireworks.splice(i, 1);
				}
			}

			for (var i = particles.length - 1; i >= 0; i--) {
				var particle = particles[i];
				particle.x += Math.cos(particle.angle) * particle.speed;
				particle.y += Math.sin(particle.angle) * particle.speed;
				particle.alpha -= particle.decay;

				if (particle.alpha <= 0) {
					particles.splice(i, 1);
				}
			}
		}

		function drawFireworks() {
			ctx.clearRect(0, 0, canvas.width, canvas.height);

			for (var i = 0; i < fireworks.length; i++) {
				var firework = fireworks[i];
				ctx.fillStyle = firework.color;
				ctx.beginPath();
				ctx.arc(firework.x, firework.y, firework.size, 0, Math.PI * 2);
				ctx.fill();
			}

			for (var i = 0; i < particles.length; i++) {
				var particle = particles[i];
				ctx.fillStyle = 'rgba(' + hexToRgb(particle.color) + ',' + particle.alpha + ')';
				ctx.beginPath();
				ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
				ctx.fill();
			}
		}

		function loop() {
			updateFireworks();
			drawFireworks();
			requestAnimationFrame(loop);
		}

		// 创建烟花
		for (var i = 0; i < 100; i++) {
			createFirework(canvas.width / 2, canvas.height, Math.random() * canvas.width, Math.random() * canvas.height / 2);
		}

		loop();

		// 5秒后隐藏烟花效果和欢迎文字
		setTimeout(function () {
			fireworksContainer.style.display = 'none';
			fireworks = [];
			particles = [];
			ctx.clearRect(0, 0, canvas.width, canvas.height);
		}, 5000);
	}

	function hexToRgb(hex) {
		var bigint = parseInt(hex.substring(1), 16);
		var r = (bigint >> 16) & 255;
		var g = (bigint >> 8) & 255;
		var b = bigint & 255;
		return r + "," + g + "," + b;
	}
</script>